<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>思而勤工作室</title>
	<link rel="stylesheet" href="blog.css">
</head>
<body>
<div id="container">
<a href="index.html">回目录</a>
<h1>jquery mobile和长连接的使用</h1>
<div><p>尝试进行前后端分离的编程。</p>

<p>前后端分离的本质是第一次载入的页面只有静态部分，动态部分都由异步载入。这样这个静态页面可以用缓存到服务器某级节点，甚至缓存到客户端。而之后的异步操作只需要交互数据，页面的变化由浏览器完成，最大程度减轻了带宽压力。</p>

<p>jquery mobile是一个用于构建移动页面的前端框架，比较大而全，连<a href="http://www.w3school.com.cn/jquerymobile/">w3school都有教程</a>，但感觉不是特别好。</p>

<p>个人<a href="http://test1.zidafone.com/">做了个实验页面</a>，感觉足够说明问题了。</p>

<p>做这种小巧的demo，后端还是用<a href="http://www.jfinal.com/">jfinal</a>最爽快，占服务器内存小，打出的war包也小，轻快自在。确实称得上急速两个字。</p>

<p>下午做一个<a href="http://test1.zidafone.com/chess/">小棋类游戏</a>，涉及服务器端状态和长连接的问题。服务器端状态如果嫌存到数据库太麻烦，直接用一个单例对象的属性记录状态，所有线程都能访问。长连接则需要服务器端有个step之类的标识符，每次访问带着客户端step过来，如果客户端step和服务端step相等，则服务器端等待100毫秒，再进行下一次检测，直到服务端有更新的step，把新的服务端状态返回给客户端，客户端根据之更新页面之后，再立刻发一个带有step的请求。</p>

<p>一个线程对单例对象状态的改变是否会被另一个线程的访问迅速看到，需要再读一遍那本讲并发编程的书籍。TO DO。</p>

<p>最后，棋类游戏的通用框架是请求包括起始格坐标和目标格坐标，服务器端根据棋局情况判断这个请求是否合理，比如马走日相走田之类，如果合理就更新服务端状态。这个服务端状态的变化会导致长连接那个请求返回。</p>

<p>长连接请求是长连接请求；操作请求是操作请求。绝对不能混淆。</p>
</div>
</div>
</body>
</html>